class IsingModel{constructor(t=20){this.size=t,this.spins=Array(t*t).fill().map(()=>Math.random()<.5?1:-1),this.temperature=2}simulateSteps(t){for(let e=0;e<t;e++){const t=Math.floor(Math.random()*this.size),e=Math.floor(Math.random()*this.size),i=t*this.size+e;let s=0;const n=[(t+1)%this.size*this.size+e,(t-1+this.size)%this.size*this.size+e,t*this.size+(e+1)%this.size,t*this.size+(e-1+this.size)%this.size];for(const t of n)s+=2*this.spins[i]*this.spins[t];(s<=0||Math.random()<Math.exp(-s/this.temperature))&&(this.spins[i]*=-1)}}draw(t){const e=t.getContext("2d"),i=Math.floor(t.width/this.size);e.clearRect(0,0,t.width,t.height);for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++){const n=t*this.size+s;e.fillStyle=1===this.spins[n]?"black":"white",e.fillRect(s*i,t*i,i,i),e.strokeStyle="#ccc",e.strokeRect(s*i,t*i,i,i)}}getMagnetization(){return Math.abs(this.spins.reduce((t,e)=>t+e,0)/(this.size*this.size))}}document.addEventListener("DOMContentLoaded",function(){function t(){h&&(r.simulateSteps(5),r.draw(e),n.textContent=r.getMagnetization().toFixed(3),d=requestAnimationFrame(t))}const e=document.getElementById("ising-canvas"),i=document.getElementById("temp-slider"),s=document.getElementById("temp-value"),n=document.getElementById("mag-value"),a=document.getElementById("start-stop"),o=document.getElementById("reset"),r=new IsingModel(50);let h=!1,d=null;r.draw(e),i.addEventListener("input",function(){r.temperature=parseFloat(this.value),s.textContent=r.temperature.toFixed(2)}),s.textContent=r.temperature.toFixed(2),a.addEventListener("click",function(){h=!h,this.textContent=h?"Stop":"Start",this.className=h?"btn stop":"btn start",h?t():d&&cancelAnimationFrame(d)}),o.addEventListener("click",function(){r.spins=Array(r.size*r.size).fill().map(()=>Math.random()<.5?1:-1),r.draw(e),n.textContent=r.getMagnetization().toFixed(3)})});